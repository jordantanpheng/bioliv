/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ContentChildren, QueryList, ElementRef, ChangeDetectorRef, HostListener, NgZone, } from '@angular/core';
import { SkltnBoneDirective } from '../directives/skltn-bone.directive';
import { DomSanitizer } from '@angular/platform-browser';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { SkltnService } from '../services/skltn.service';
export class SkltnComponent {
    /**
     * @param {?} skltnService
     * @param {?} element
     * @param {?} sanitizer
     * @param {?} cd
     * @param {?} zone
     */
    constructor(skltnService, element, sanitizer, cd, zone) {
        this.skltnService = skltnService;
        this.element = element;
        this.sanitizer = sanitizer;
        this.cd = cd;
        this.zone = zone;
        this.showSkltn = true;
        this.updStream$ = new Subject();
        this.defaultConfig = {
            rectRadius: 4,
            bgFill: '#ddd',
            flareFill: 'rgba(255, 255, 255, 0.6)',
            flareWidth: '150px',
            duration: 1200,
            delay: 0,
            timing: 'ease-in-out',
        };
        /** @type {?} */
        const conf = this.skltnService.config;
        this.rectRadius = conf.rectRadius;
        this.bgFill = conf.bgFill;
        this.flareFill = conf.flareFill;
        this.flareWidth = conf.flareWidth;
        this.duration = conf.duration;
        this.delay = conf.delay;
        this.timing = conf.timing;
        this.sufix = this.getSufixWithID();
        this.gradientId = 'gradient-' + this.sufix;
        this.maskId = 'mask-' + this.sufix;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onResize(event) {
        this.updStream$.next();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.animationCss = this.sanitizer.bypassSecurityTrustHtml(`
    <style>
    @keyframes flareAnimation {
        0% { x: calc(0% - ${this.flareWidth}); }
        100% { x: 100%; }
    }
    .flare {
      animation-name: flareAnimation;
      animation-duration: ${this.duration}ms;
      animation-timing-function: ${this.timing};
      animation-iteration-count: infinite;
      animation-delay: ${this.delay}ms;
    }
    </style>`);
        // Update
        this.updStream$.pipe(debounceTime(100)).subscribe((/**
         * @return {?}
         */
        () => this.calcShapes()));
        // Update href (Safari Bug, SVG Ref Path)
        this.href = window.location.href;
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        () => {
            this.checkHrefIntervalID = window.setInterval((/**
             * @return {?}
             */
            () => {
                if (this.href !== window.location.href) {
                    this.href = window.location.href;
                    this.cd.detectChanges();
                }
            }), 100);
        }));
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.calcShapes();
        this.cd.detectChanges();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.checkHrefIntervalID) {
            window.clearInterval(this.checkHrefIntervalID);
        }
    }
    /**
     * @return {?}
     */
    getSufixWithID() {
        return Math.random().toString(36).substr(2, 4) + '-skltn';
    }
    /**
     * @return {?}
     */
    calcShapes() {
        // Root SVG Element
        /** @type {?} */
        const el = this.element.nativeElement;
        this.parentClientRect = el.getBoundingClientRect();
        this.viewBox = `0 0 ${this.parentClientRect.width} ${this.parentClientRect.height}`;
        // SVG Shapes
        this.shapes = this.bones.toArray().map((/**
         * @param {?} bone
         * @return {?}
         */
        bone => {
            /** @type {?} */
            const boneEl = bone.element.nativeElement;
            /** @type {?} */
            const clientRect = boneEl.getBoundingClientRect();
            /** @type {?} */
            const radius = bone.rectRadius || this.rectRadius;
            if (bone.type === 'circle') {
                return {
                    type: 'circle',
                    cx: clientRect.x - this.parentClientRect.x + clientRect.width / 2,
                    cy: clientRect.y - this.parentClientRect.y + clientRect.height / 2,
                    rx: clientRect.width / 2,
                    ry: clientRect.height / 2,
                };
            }
            if (bone.type === 'path') {
                /** @type {?} */
                const x = clientRect.x - this.parentClientRect.x;
                /** @type {?} */
                const y = clientRect.y - this.parentClientRect.y;
                /** @type {?} */
                let transform = `translate(${x}, ${y})`;
                if (bone.pathWidth && bone.pathHeight) {
                    /** @type {?} */
                    const xScale = (clientRect.width / bone.pathWidth).toFixed(2);
                    /** @type {?} */
                    const yScale = (clientRect.height / bone.pathHeight).toFixed(2);
                    transform += ` scale(${xScale}, ${yScale})`;
                }
                return {
                    type: 'path',
                    width: clientRect.width,
                    height: clientRect.height,
                    transform,
                    template: bone.template,
                };
            }
            return {
                type: 'rect',
                x: clientRect.x - this.parentClientRect.x,
                y: clientRect.y - this.parentClientRect.y,
                width: clientRect.width,
                height: clientRect.height,
                rx: radius,
                ry: radius,
            };
        }));
    }
}
SkltnComponent.decorators = [
    { type: Component, args: [{
                selector: 'skltn-root',
                template: "<div [innerHTML]=\"animationCss\"></div>\n\n<svg class=\"svg-root\" x=\"0px\" y=\"0px\" [attr.viewBox]=\"viewBox\" *ngIf=\"shapes?.length && showSkltn\">\n\n  <!-- Gradient -->\n  <linearGradient [attr.id]=\"gradientId\">\n      <stop class=\"stop stop--1\" [attr.stop-color]=\"flareFill\" stop-opacity=\"0\" offset=\"0\"></stop>\n      <stop class=\"stop stop--2\" [attr.stop-color]=\"flareFill\" stop-opacity=\"1\" offset=\"50%\"></stop>\n      <stop class=\"stop stop--3\" [attr.stop-color]=\"flareFill\" stop-opacity=\"0\" offset=\"100%\"></stop>\n    </linearGradient>\n\n  <defs>\n    <!-- Mask -->\n    <mask [attr.id]=\"maskId\">\n      <!-- Shapes -->\n      <ng-container *ngFor=\"let shape of shapes\">\n        <!-- Rect Type -->\n        <rect *ngIf=\"shape.type === 'rect'\" [attr.x]=\"shape.x\" [attr.y]=\"shape.y\" [attr.rx]=\"shape.rx\"\n          [attr.ry]=\"shape.ry\" [attr.width]=\"shape.width\" [attr.height]=\"shape.height\" fill=\"#FFFFFF\" />\n        <!-- Circle Type -->\n        <ellipse *ngIf=\"shape.type === 'circle'\" [attr.cx]=\"shape.cx\" [attr.cy]=\"shape.cy\" [attr.rx]=\"shape.rx\" [attr.ry]=\"shape.ry\" fill=\"#FFFFFF\"></ellipse>\n        <!-- Path Type -->\n        <ng-container *ngIf=\"shape.type === 'path'\">\n          <g fill=\"#FFFFFF\" [attr.transform]=\"shape.transform\">\n            <ng-container *ngTemplateOutlet=\"shape.template\"></ng-container>\n          </g>\n        </ng-container>\n      </ng-container>\n    </mask>\n  </defs>\n\n  <g [attr.mask]=\"'url(' + href + '#' + maskId + ')'\">\n    <!-- Background Rectangle -->\n    <rect class=\"bg-fill\" x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" [attr.fill]=\"bgFill\"></rect>\n\n    <!-- Flare -->\n    <rect class=\"flare\" [attr.x]=\"'-' + flareWidth\" y=\"0\" [attr.width]=\"flareWidth\" height=\"100%\" [attr.fill]=\"'url(' + href + '#' + gradientId + ')'\"></rect>\n  </g>\n\n</svg>\n\n<ng-content></ng-content>\n",
                styles: [":host{display:block;position:relative}.svg-root{display:block;position:absolute;top:0;bottom:0;left:0;right:0;z-index:1}"]
            }] }
];
/** @nocollapse */
SkltnComponent.ctorParameters = () => [
    { type: SkltnService },
    { type: ElementRef },
    { type: DomSanitizer },
    { type: ChangeDetectorRef },
    { type: NgZone }
];
SkltnComponent.propDecorators = {
    rectRadius: [{ type: Input }],
    bgFill: [{ type: Input }],
    flareFill: [{ type: Input }],
    flareWidth: [{ type: Input }],
    duration: [{ type: Input }],
    delay: [{ type: Input }],
    timing: [{ type: Input }],
    showSkltn: [{ type: Input }],
    bones: [{ type: ContentChildren, args: [SkltnBoneDirective,] }],
    onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    SkltnComponent.prototype.rectRadius;
    /** @type {?} */
    SkltnComponent.prototype.bgFill;
    /** @type {?} */
    SkltnComponent.prototype.flareFill;
    /** @type {?} */
    SkltnComponent.prototype.flareWidth;
    /** @type {?} */
    SkltnComponent.prototype.duration;
    /** @type {?} */
    SkltnComponent.prototype.delay;
    /** @type {?} */
    SkltnComponent.prototype.timing;
    /** @type {?} */
    SkltnComponent.prototype.showSkltn;
    /** @type {?} */
    SkltnComponent.prototype.bones;
    /** @type {?} */
    SkltnComponent.prototype.viewBox;
    /** @type {?} */
    SkltnComponent.prototype.shapes;
    /** @type {?} */
    SkltnComponent.prototype.parentClientRect;
    /** @type {?} */
    SkltnComponent.prototype.animationCss;
    /** @type {?} */
    SkltnComponent.prototype.href;
    /** @type {?} */
    SkltnComponent.prototype.sufix;
    /** @type {?} */
    SkltnComponent.prototype.gradientId;
    /** @type {?} */
    SkltnComponent.prototype.maskId;
    /** @type {?} */
    SkltnComponent.prototype.checkHrefIntervalID;
    /** @type {?} */
    SkltnComponent.prototype.updStream$;
    /** @type {?} */
    SkltnComponent.prototype.defaultConfig;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.skltnService;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.element;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.sanitizer;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tsdG4uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNrbHRuLyIsInNvdXJjZXMiOlsibGliL3NrbHRuL3NrbHRuLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFBVSxLQUFLLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQ2hFLGlCQUFpQixFQUFFLFlBQVksRUFBeUIsTUFBTSxHQUMvRCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsWUFBWSxFQUFZLE1BQU0sMkJBQTJCLENBQUM7QUFDbkUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFOUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBT3pELE1BQU0sT0FBTyxjQUFjOzs7Ozs7OztJQWtEekIsWUFDVSxZQUEwQixFQUMxQixPQUFtQixFQUNuQixTQUF1QixFQUN2QixFQUFxQixFQUNyQixJQUFZO1FBSlosaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUNuQixjQUFTLEdBQVQsU0FBUyxDQUFjO1FBQ3ZCLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQ3JCLFNBQUksR0FBSixJQUFJLENBQVE7UUF2Q2IsY0FBUyxHQUFHLElBQUksQ0FBQztRQXNCMUIsZUFBVSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7UUFFM0Isa0JBQWEsR0FBZ0I7WUFDM0IsVUFBVSxFQUFFLENBQUM7WUFDYixNQUFNLEVBQUUsTUFBTTtZQUNkLFNBQVMsRUFBRSwwQkFBMEI7WUFDckMsVUFBVSxFQUFFLE9BQU87WUFDbkIsUUFBUSxFQUFFLElBQUk7WUFDZCxLQUFLLEVBQUUsQ0FB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SztxQkFFTCxLQUFLO3dCQUVMLEtBQUs7eUJBRUwsS0FBSzt1QkFFTCxLQUFLO29CQUVMLEtBQUs7cUJBRUwsS0FBSzt3QkFFTCxLQUFLO29CQUVMLGVBQWUsU0FBQyxrQkFBa0I7dUJBb0RsQyxZQUFZLFNBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxDQUFDOzs7O0lBcEV6QyxvQ0FBNEI7O0lBRTVCLGdDQUF3Qjs7SUFFeEIsbUNBQTJCOztJQUUzQixvQ0FBNEI7O0lBRTVCLGtDQUEwQjs7SUFFMUIsK0JBQXVCOztJQUV2QixnQ0FBd0I7O0lBRXhCLG1DQUEwQjs7SUFFMUIsK0JBQTBFOztJQUUxRSxpQ0FBZ0I7O0lBRWhCLGdDQUFjOztJQUVkLDBDQUFzQjs7SUFFdEIsc0NBQXVCOztJQUV2Qiw4QkFBYTs7SUFFYiwrQkFBYzs7SUFFZCxvQ0FBbUI7O0lBRW5CLGdDQUFlOztJQUVmLDZDQUE0Qjs7SUFFNUIsb0NBQTJCOztJQUUzQix1Q0FRRTs7Ozs7SUFHQSxzQ0FBa0M7Ozs7O0lBQ2xDLGlDQUEyQjs7Ozs7SUFDM0IsbUNBQStCOzs7OztJQUMvQiw0QkFBNkI7Ozs7O0lBQzdCLDhCQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgQ29udGVudENoaWxkcmVuLCBRdWVyeUxpc3QsIEVsZW1lbnRSZWYsXG4gIENoYW5nZURldGVjdG9yUmVmLCBIb3N0TGlzdGVuZXIsIEFmdGVyVmlld0luaXQsIEluamVjdCwgTmdab25lLCBPbkRlc3Ryb3ksXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU2tsdG5Cb25lRGlyZWN0aXZlIH0gZnJvbSAnLi4vZGlyZWN0aXZlcy9za2x0bi1ib25lLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBEb21TYW5pdGl6ZXIsIFNhZmVIdG1sIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZVRpbWUgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBTa2x0bkNvbmZpZyB9IGZyb20gJy4uL2ludGVyZmFjZXMvc2tsdG4tY29uZmlnJztcbmltcG9ydCB7IFNrbHRuU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL3NrbHRuLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdza2x0bi1yb290JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3NrbHRuLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vc2tsdG4uY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBTa2x0bkNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlclZpZXdJbml0IHtcblxuICBASW5wdXQoKSByZWN0UmFkaXVzOiBudW1iZXI7XG5cbiAgQElucHV0KCkgYmdGaWxsOiBzdHJpbmc7XG5cbiAgQElucHV0KCkgZmxhcmVGaWxsOiBzdHJpbmc7XG5cbiAgQElucHV0KCkgZmxhcmVXaWR0aDogc3RyaW5nO1xuXG4gIEBJbnB1dCgpIGR1cmF0aW9uOiBudW1iZXI7XG5cbiAgQElucHV0KCkgZGVsYXk6IG51bWJlcjtcblxuICBASW5wdXQoKSB0aW1pbmc6IHN0cmluZztcblxuICBASW5wdXQoKSBzaG93U2tsdG4gPSB0cnVlO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oU2tsdG5Cb25lRGlyZWN0aXZlKSBib25lczogUXVlcnlMaXN0PFNrbHRuQm9uZURpcmVjdGl2ZT47XG5cbiAgdmlld0JveDogc3RyaW5nO1xuXG4gIHNoYXBlczogYW55W107XG5cbiAgcGFyZW50Q2xpZW50UmVjdDogYW55O1xuXG4gIGFuaW1hdGlvbkNzczogU2FmZUh0bWw7XG5cbiAgaHJlZjogc3RyaW5nO1xuXG4gIHN1Zml4OiBzdHJpbmc7XG5cbiAgZ3JhZGllbnRJZDogc3RyaW5nO1xuXG4gIG1hc2tJZDogc3RyaW5nO1xuXG4gIGNoZWNrSHJlZkludGVydmFsSUQ6IG51bWJlcjtcblxuICB1cGRTdHJlYW0kID0gbmV3IFN1YmplY3QoKTtcblxuICBkZWZhdWx0Q29uZmlnOiBTa2x0bkNvbmZpZyA9IHtcbiAgICByZWN0UmFkaXVzOiA0LFxuICAgIGJnRmlsbDogJyNkZGQnLFxuICAgIGZsYXJlRmlsbDogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC42KScsXG4gICAgZmxhcmVXaWR0aDogJzE1MHB4JyxcbiAgICBkdXJhdGlvbjogMTIwMCxcbiAgICBkZWxheTogMCxcbiAgICB0aW1pbmc6ICdlYXNlLWluLW91dCcsXG4gIH07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBza2x0blNlcnZpY2U6IFNrbHRuU2VydmljZSxcbiAgICBwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gICAgcHJpdmF0ZSBzYW5pdGl6ZXI6IERvbVNhbml0aXplcixcbiAgICBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIHpvbmU6IE5nWm9uZSxcbiAgKSB7XG4gICAgY29uc3QgY29uZiA9IHRoaXMuc2tsdG5TZXJ2aWNlLmNvbmZpZztcbiAgICB0aGlzLnJlY3RSYWRpdXMgPSBjb25mLnJlY3RSYWRpdXM7XG4gICAgdGhpcy5iZ0ZpbGwgPSBjb25mLmJnRmlsbDtcbiAgICB0aGlzLmZsYXJlRmlsbCA9IGNvbmYuZmxhcmVGaWxsO1xuICAgIHRoaXMuZmxhcmVXaWR0aCA9IGNvbmYuZmxhcmVXaWR0aDtcbiAgICB0aGlzLmR1cmF0aW9uID0gY29uZi5kdXJhdGlvbjtcbiAgICB0aGlzLmRlbGF5ID0gY29uZi5kZWxheTtcbiAgICB0aGlzLnRpbWluZyA9IGNvbmYudGltaW5nO1xuICAgIHRoaXMuc3VmaXggPSB0aGlzLmdldFN1Zml4V2l0aElEKCk7XG4gICAgdGhpcy5ncmFkaWVudElkID0gJ2dyYWRpZW50LScgKyB0aGlzLnN1Zml4O1xuICAgIHRoaXMubWFza0lkID0gJ21hc2stJyArIHRoaXMuc3VmaXg7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6cmVzaXplJywgWyckZXZlbnQnXSlcbiAgb25SZXNpemUoZXZlbnQ6IEV2ZW50KSB7XG4gICAgdGhpcy51cGRTdHJlYW0kLm5leHQoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuYW5pbWF0aW9uQ3NzID0gdGhpcy5zYW5pdGl6ZXIuYnlwYXNzU2VjdXJpdHlUcnVzdEh0bWwoYFxuICAgIDxzdHlsZT5cbiAgICBAa2V5ZnJhbWVzIGZsYXJlQW5pbWF0aW9uIHtcbiAgICAgICAgMCUgeyB4OiBjYWxjKDAlIC0gJHt0aGlzLmZsYXJlV2lkdGh9KTsgfVxuICAgICAgICAxMDAlIHsgeDogMTAwJTsgfVxuICAgIH1cbiAgICAuZmxhcmUge1xuICAgICAgYW5pbWF0aW9uLW5hbWU6IGZsYXJlQW5pbWF0aW9uO1xuICAgICAgYW5pbWF0aW9uLWR1cmF0aW9uOiAke3RoaXMuZHVyYXRpb259bXM7XG4gICAgICBhbmltYXRpb24tdGltaW5nLWZ1bmN0aW9uOiAke3RoaXMudGltaW5nfTtcbiAgICAgIGFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQ6IGluZmluaXRlO1xuICAgICAgYW5pbWF0aW9uLWRlbGF5OiAke3RoaXMuZGVsYXl9bXM7XG4gICAgfVxuICAgIDwvc3R5bGU+YCk7XG5cbiAgICAvLyBVcGRhdGVcbiAgICB0aGlzLnVwZFN0cmVhbSQucGlwZShcbiAgICAgIGRlYm91bmNlVGltZSgxMDApLFxuICAgICkuc3Vic2NyaWJlKCgpID0+IHRoaXMuY2FsY1NoYXBlcygpKTtcblxuICAgIC8vIFVwZGF0ZSBocmVmIChTYWZhcmkgQnVnLCBTVkcgUmVmIFBhdGgpXG4gICAgdGhpcy5ocmVmID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG5cbiAgICB0aGlzLnpvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5jaGVja0hyZWZJbnRlcnZhbElEID0gd2luZG93LnNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMuaHJlZiAhPT0gd2luZG93LmxvY2F0aW9uLmhyZWYpIHtcbiAgICAgICAgICB0aGlzLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICAgICAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgICAgICAgfVxuICAgICAgfSwgMTAwKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmNhbGNTaGFwZXMoKTtcbiAgICB0aGlzLmNkLmRldGVjdENoYW5nZXMoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLmNoZWNrSHJlZkludGVydmFsSUQpIHtcbiAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuY2hlY2tIcmVmSW50ZXJ2YWxJRCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0U3VmaXhXaXRoSUQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDQpICsgJy1za2x0bic7XG4gIH1cblxuICBjYWxjU2hhcGVzKCk6IHZvaWQge1xuICAgIC8vIFJvb3QgU1ZHIEVsZW1lbnRcbiAgICBjb25zdCBlbCA9IHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50O1xuICAgIHRoaXMucGFyZW50Q2xpZW50UmVjdCA9IGVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHRoaXMudmlld0JveCA9IGAwIDAgJHt0aGlzLnBhcmVudENsaWVudFJlY3Qud2lkdGh9ICR7dGhpcy5wYXJlbnRDbGllbnRSZWN0LmhlaWdodH1gO1xuXG4gICAgLy8gU1ZHIFNoYXBlc1xuICAgIHRoaXMuc2hhcGVzID0gdGhpcy5ib25lcy50b0FycmF5KCkubWFwKGJvbmUgPT4ge1xuICAgICAgY29uc3QgYm9uZUVsID0gYm9uZS5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gICAgICBjb25zdCBjbGllbnRSZWN0ID0gYm9uZUVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgY29uc3QgcmFkaXVzID0gYm9uZS5yZWN0UmFkaXVzIHx8IHRoaXMucmVjdFJhZGl1cztcbiAgICAgIGlmIChib25lLnR5cGUgPT09ICdjaXJjbGUnKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZTogJ2NpcmNsZScsXG4gICAgICAgICAgY3g6IGNsaWVudFJlY3QueCAtIHRoaXMucGFyZW50Q2xpZW50UmVjdC54ICsgY2xpZW50UmVjdC53aWR0aCAvIDIsXG4gICAgICAgICAgY3k6IGNsaWVudFJlY3QueSAtIHRoaXMucGFyZW50Q2xpZW50UmVjdC55ICsgY2xpZW50UmVjdC5oZWlnaHQgLyAyLFxuICAgICAgICAgIHJ4OiBjbGllbnRSZWN0LndpZHRoIC8gMixcbiAgICAgICAgICByeTogY2xpZW50UmVjdC5oZWlnaHQgLyAyLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYgKGJvbmUudHlwZSA9PT0gJ3BhdGgnKSB7XG4gICAgICAgIGNvbnN0IHggPSBjbGllbnRSZWN0LnggLSB0aGlzLnBhcmVudENsaWVudFJlY3QueDtcbiAgICAgICAgY29uc3QgeSA9IGNsaWVudFJlY3QueSAtIHRoaXMucGFyZW50Q2xpZW50UmVjdC55O1xuICAgICAgICBsZXQgdHJhbnNmb3JtID0gYHRyYW5zbGF0ZSgke3h9LCAke3l9KWA7XG4gICAgICAgIGlmIChib25lLnBhdGhXaWR0aCAmJiBib25lLnBhdGhIZWlnaHQpIHtcbiAgICAgICAgICBjb25zdCB4U2NhbGUgPSAoY2xpZW50UmVjdC53aWR0aCAvIGJvbmUucGF0aFdpZHRoKS50b0ZpeGVkKDIpO1xuICAgICAgICAgIGNvbnN0IHlTY2FsZSA9IChjbGllbnRSZWN0LmhlaWdodCAvIGJvbmUucGF0aEhlaWdodCkudG9GaXhlZCgyKTtcbiAgICAgICAgICB0cmFuc2Zvcm0gKz0gYCBzY2FsZSgke3hTY2FsZX0sICR7eVNjYWxlfSlgO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZTogJ3BhdGgnLFxuICAgICAgICAgIHdpZHRoOiBjbGllbnRSZWN0LndpZHRoLFxuICAgICAgICAgIGhlaWdodDogY2xpZW50UmVjdC5oZWlnaHQsXG4gICAgICAgICAgdHJhbnNmb3JtLFxuICAgICAgICAgIHRlbXBsYXRlOiBib25lLnRlbXBsYXRlLFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogJ3JlY3QnLFxuICAgICAgICB4OiBjbGllbnRSZWN0LnggLSB0aGlzLnBhcmVudENsaWVudFJlY3QueCxcbiAgICAgICAgeTogY2xpZW50UmVjdC55IC0gdGhpcy5wYXJlbnRDbGllbnRSZWN0LnksXG4gICAgICAgIHdpZHRoOiBjbGllbnRSZWN0LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IGNsaWVudFJlY3QuaGVpZ2h0LFxuICAgICAgICByeDogcmFkaXVzLFxuICAgICAgICByeTogcmFkaXVzLFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG59XG4iXX0=