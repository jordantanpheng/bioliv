/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ContentChildren, QueryList, ElementRef, ChangeDetectorRef, HostListener, NgZone, } from '@angular/core';
import { SkltnBoneDirective } from '../directives/skltn-bone.directive';
import { DomSanitizer } from '@angular/platform-browser';
import { Subject } from 'rxjs';
import { debounceTime } from 'rxjs/operators';
import { SkltnService } from '../services/skltn.service';
var SkltnComponent = /** @class */ (function () {
    function SkltnComponent(skltnService, element, sanitizer, cd, zone) {
        this.skltnService = skltnService;
        this.element = element;
        this.sanitizer = sanitizer;
        this.cd = cd;
        this.zone = zone;
        this.showSkltn = true;
        this.updStream$ = new Subject();
        this.defaultConfig = {
            rectRadius: 4,
            bgFill: '#ddd',
            flareFill: 'rgba(255, 255, 255, 0.6)',
            flareWidth: '150px',
            duration: 1200,
            delay: 0,
            timing: 'ease-in-out',
        };
        /** @type {?} */
        var conf = this.skltnService.config;
        this.rectRadius = conf.rectRadius;
        this.bgFill = conf.bgFill;
        this.flareFill = conf.flareFill;
        this.flareWidth = conf.flareWidth;
        this.duration = conf.duration;
        this.delay = conf.delay;
        this.timing = conf.timing;
        this.sufix = this.getSufixWithID();
        this.gradientId = 'gradient-' + this.sufix;
        this.maskId = 'mask-' + this.sufix;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    SkltnComponent.prototype.onResize = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.updStream$.next();
    };
    /**
     * @return {?}
     */
    SkltnComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.animationCss = this.sanitizer.bypassSecurityTrustHtml("\n    <style>\n    @keyframes flareAnimation {\n        0% { x: calc(0% - " + this.flareWidth + "); }\n        100% { x: 100%; }\n    }\n    .flare {\n      animation-name: flareAnimation;\n      animation-duration: " + this.duration + "ms;\n      animation-timing-function: " + this.timing + ";\n      animation-iteration-count: infinite;\n      animation-delay: " + this.delay + "ms;\n    }\n    </style>");
        // Update
        this.updStream$.pipe(debounceTime(100)).subscribe((/**
         * @return {?}
         */
        function () { return _this.calcShapes(); }));
        // Update href (Safari Bug, SVG Ref Path)
        this.href = window.location.href;
        this.zone.runOutsideAngular((/**
         * @return {?}
         */
        function () {
            _this.checkHrefIntervalID = window.setInterval((/**
             * @return {?}
             */
            function () {
                if (_this.href !== window.location.href) {
                    _this.href = window.location.href;
                    _this.cd.detectChanges();
                }
            }), 100);
        }));
    };
    /**
     * @return {?}
     */
    SkltnComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        this.calcShapes();
        this.cd.detectChanges();
    };
    /**
     * @return {?}
     */
    SkltnComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.checkHrefIntervalID) {
            window.clearInterval(this.checkHrefIntervalID);
        }
    };
    /**
     * @return {?}
     */
    SkltnComponent.prototype.getSufixWithID = /**
     * @return {?}
     */
    function () {
        return Math.random().toString(36).substr(2, 4) + '-skltn';
    };
    /**
     * @return {?}
     */
    SkltnComponent.prototype.calcShapes = /**
     * @return {?}
     */
    function () {
        var _this = this;
        // Root SVG Element
        /** @type {?} */
        var el = this.element.nativeElement;
        this.parentClientRect = el.getBoundingClientRect();
        this.viewBox = "0 0 " + this.parentClientRect.width + " " + this.parentClientRect.height;
        // SVG Shapes
        this.shapes = this.bones.toArray().map((/**
         * @param {?} bone
         * @return {?}
         */
        function (bone) {
            /** @type {?} */
            var boneEl = bone.element.nativeElement;
            /** @type {?} */
            var clientRect = boneEl.getBoundingClientRect();
            /** @type {?} */
            var radius = bone.rectRadius || _this.rectRadius;
            if (bone.type === 'circle') {
                return {
                    type: 'circle',
                    cx: clientRect.x - _this.parentClientRect.x + clientRect.width / 2,
                    cy: clientRect.y - _this.parentClientRect.y + clientRect.height / 2,
                    rx: clientRect.width / 2,
                    ry: clientRect.height / 2,
                };
            }
            if (bone.type === 'path') {
                /** @type {?} */
                var x = clientRect.x - _this.parentClientRect.x;
                /** @type {?} */
                var y = clientRect.y - _this.parentClientRect.y;
                /** @type {?} */
                var transform = "translate(" + x + ", " + y + ")";
                if (bone.pathWidth && bone.pathHeight) {
                    /** @type {?} */
                    var xScale = (clientRect.width / bone.pathWidth).toFixed(2);
                    /** @type {?} */
                    var yScale = (clientRect.height / bone.pathHeight).toFixed(2);
                    transform += " scale(" + xScale + ", " + yScale + ")";
                }
                return {
                    type: 'path',
                    width: clientRect.width,
                    height: clientRect.height,
                    transform: transform,
                    template: bone.template,
                };
            }
            return {
                type: 'rect',
                x: clientRect.x - _this.parentClientRect.x,
                y: clientRect.y - _this.parentClientRect.y,
                width: clientRect.width,
                height: clientRect.height,
                rx: radius,
                ry: radius,
            };
        }));
    };
    SkltnComponent.decorators = [
        { type: Component, args: [{
                    selector: 'skltn-root',
                    template: "<div [innerHTML]=\"animationCss\"></div>\n\n<svg class=\"svg-root\" x=\"0px\" y=\"0px\" [attr.viewBox]=\"viewBox\" *ngIf=\"shapes?.length && showSkltn\">\n\n  <!-- Gradient -->\n  <linearGradient [attr.id]=\"gradientId\">\n      <stop class=\"stop stop--1\" [attr.stop-color]=\"flareFill\" stop-opacity=\"0\" offset=\"0\"></stop>\n      <stop class=\"stop stop--2\" [attr.stop-color]=\"flareFill\" stop-opacity=\"1\" offset=\"50%\"></stop>\n      <stop class=\"stop stop--3\" [attr.stop-color]=\"flareFill\" stop-opacity=\"0\" offset=\"100%\"></stop>\n    </linearGradient>\n\n  <defs>\n    <!-- Mask -->\n    <mask [attr.id]=\"maskId\">\n      <!-- Shapes -->\n      <ng-container *ngFor=\"let shape of shapes\">\n        <!-- Rect Type -->\n        <rect *ngIf=\"shape.type === 'rect'\" [attr.x]=\"shape.x\" [attr.y]=\"shape.y\" [attr.rx]=\"shape.rx\"\n          [attr.ry]=\"shape.ry\" [attr.width]=\"shape.width\" [attr.height]=\"shape.height\" fill=\"#FFFFFF\" />\n        <!-- Circle Type -->\n        <ellipse *ngIf=\"shape.type === 'circle'\" [attr.cx]=\"shape.cx\" [attr.cy]=\"shape.cy\" [attr.rx]=\"shape.rx\" [attr.ry]=\"shape.ry\" fill=\"#FFFFFF\"></ellipse>\n        <!-- Path Type -->\n        <ng-container *ngIf=\"shape.type === 'path'\">\n          <g fill=\"#FFFFFF\" [attr.transform]=\"shape.transform\">\n            <ng-container *ngTemplateOutlet=\"shape.template\"></ng-container>\n          </g>\n        </ng-container>\n      </ng-container>\n    </mask>\n  </defs>\n\n  <g [attr.mask]=\"'url(' + href + '#' + maskId + ')'\">\n    <!-- Background Rectangle -->\n    <rect class=\"bg-fill\" x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" [attr.fill]=\"bgFill\"></rect>\n\n    <!-- Flare -->\n    <rect class=\"flare\" [attr.x]=\"'-' + flareWidth\" y=\"0\" [attr.width]=\"flareWidth\" height=\"100%\" [attr.fill]=\"'url(' + href + '#' + gradientId + ')'\"></rect>\n  </g>\n\n</svg>\n\n<ng-content></ng-content>\n",
                    styles: [":host{display:block;position:relative}.svg-root{display:block;position:absolute;top:0;bottom:0;left:0;right:0;z-index:1}"]
                }] }
    ];
    /** @nocollapse */
    SkltnComponent.ctorParameters = function () { return [
        { type: SkltnService },
        { type: ElementRef },
        { type: DomSanitizer },
        { type: ChangeDetectorRef },
        { type: NgZone }
    ]; };
    SkltnComponent.propDecorators = {
        rectRadius: [{ type: Input }],
        bgFill: [{ type: Input }],
        flareFill: [{ type: Input }],
        flareWidth: [{ type: Input }],
        duration: [{ type: Input }],
        delay: [{ type: Input }],
        timing: [{ type: Input }],
        showSkltn: [{ type: Input }],
        bones: [{ type: ContentChildren, args: [SkltnBoneDirective,] }],
        onResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
    };
    return SkltnComponent;
}());
export { SkltnComponent };
if (false) {
    /** @type {?} */
    SkltnComponent.prototype.rectRadius;
    /** @type {?} */
    SkltnComponent.prototype.bgFill;
    /** @type {?} */
    SkltnComponent.prototype.flareFill;
    /** @type {?} */
    SkltnComponent.prototype.flareWidth;
    /** @type {?} */
    SkltnComponent.prototype.duration;
    /** @type {?} */
    SkltnComponent.prototype.delay;
    /** @type {?} */
    SkltnComponent.prototype.timing;
    /** @type {?} */
    SkltnComponent.prototype.showSkltn;
    /** @type {?} */
    SkltnComponent.prototype.bones;
    /** @type {?} */
    SkltnComponent.prototype.viewBox;
    /** @type {?} */
    SkltnComponent.prototype.shapes;
    /** @type {?} */
    SkltnComponent.prototype.parentClientRect;
    /** @type {?} */
    SkltnComponent.prototype.animationCss;
    /** @type {?} */
    SkltnComponent.prototype.href;
    /** @type {?} */
    SkltnComponent.prototype.sufix;
    /** @type {?} */
    SkltnComponent.prototype.gradientId;
    /** @type {?} */
    SkltnComponent.prototype.maskId;
    /** @type {?} */
    SkltnComponent.prototype.checkHrefIntervalID;
    /** @type {?} */
    SkltnComponent.prototype.updStream$;
    /** @type {?} */
    SkltnComponent.prototype.defaultConfig;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.skltnService;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.element;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.sanitizer;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    SkltnComponent.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tsdG4uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXNrbHRuLyIsInNvdXJjZXMiOlsibGliL3NrbHRuL3NrbHRuLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFBVSxLQUFLLEVBQUUsZUFBZSxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQ2hFLGlCQUFpQixFQUFFLFlBQVksRUFBeUIsTUFBTSxHQUMvRCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxvQ0FBb0MsQ0FBQztBQUN4RSxPQUFPLEVBQUUsWUFBWSxFQUFZLE1BQU0sMkJBQTJCLENBQUM7QUFDbkUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFOUMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRXpEO0lBdURFLHdCQUNVLFlBQTBCLEVBQzFCLE9BQW1CLEVBQ25CLFNBQXVCLEVBQ3ZCLEVBQXFCLEVBQ3JCLElBQVk7UUFKWixpQkFBWSxHQUFaLFlBQVksQ0FBYztRQUMxQixZQUFPLEdBQVAsT0FBTyxDQUFZO1FBQ25CLGNBQVMsR0FBVCxTQUFTLENBQWM7UUFDdkIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFDckIsU0FBSSxHQUFKLElBQUksQ0FBUTtRQXZDYixjQUFTLEdBQUcsSUFBSSxDQUFDO1FBc0IxQixlQUFVLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUUzQixrQkFBYSxHQUFnQjtZQUMzQixVQUFVLEVBQUUsQ0FBQztZQUNiLE1BQU0sRUFBRSxNQUFNO1lBQ2QsU0FBUyxFQUFFLDBCQUEwQjtZQUNyQyxVQUFVLEVBQUUsT0FBTztZQUNuQixRQUFRLEVBQUUsSUFBSTtZQUNkLEtBQUssRUFBRSxDQUFDO1lBQ1IsTUFBTSxFQUFFLGFBQWE7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QixpQkFBaUI7Z0JBQXVDLE1BQU07Ozs2QkFnQjdELEtBQUs7eUJBRUwsS0FBSzs0QkFFTCxLQUFLOzZCQUVMLEtBQUs7MkJBRUwsS0FBSzt3QkFFTCxLQUFLO3lCQUVMLEtBQUs7NEJBRUwsS0FBSzt3QkFFTCxlQUFlLFNBQUMsa0JBQWtCOzJCQW9EbEMsWUFBWSxTQUFDLGVBQWUsRUFBRSxDQUFDLFFBQVEsQ0FBQzs7SUF1RzNDLHFCQUFDO0NBQUEsQUFsTEQsSUFrTEM7U0E3S1ksY0FBYzs7O0lBRXpCLG9DQUE0Qjs7SUFFNUIsZ0NBQXdCOztJQUV4QixtQ0FBMkI7O0lBRTNCLG9DQUE0Qjs7SUFFNUIsa0NBQTBCOztJQUUxQiwrQkFBdUI7O0lBRXZCLGdDQUF3Qjs7SUFFeEIsbUNBQTBCOztJQUUxQiwrQkFBMEU7O0lBRTFFLGlDQUFnQjs7SUFFaEIsZ0NBQWM7O0lBRWQsMENBQXNCOztJQUV0QixzQ0FBdUI7O0lBRXZCLDhCQUFhOztJQUViLCtCQUFjOztJQUVkLG9DQUFtQjs7SUFFbkIsZ0NBQWU7O0lBRWYsNkNBQTRCOztJQUU1QixvQ0FBMkI7O0lBRTNCLHVDQVFFOzs7OztJQUdBLHNDQUFrQzs7Ozs7SUFDbEMsaUNBQTJCOzs7OztJQUMzQixtQ0FBK0I7Ozs7O0lBQy9CLDRCQUE2Qjs7Ozs7SUFDN0IsOEJBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LCBPbkluaXQsIElucHV0LCBDb250ZW50Q2hpbGRyZW4sIFF1ZXJ5TGlzdCwgRWxlbWVudFJlZixcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsIEhvc3RMaXN0ZW5lciwgQWZ0ZXJWaWV3SW5pdCwgSW5qZWN0LCBOZ1pvbmUsIE9uRGVzdHJveSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTa2x0bkJvbmVEaXJlY3RpdmUgfSBmcm9tICcuLi9kaXJlY3RpdmVzL3NrbHRuLWJvbmUuZGlyZWN0aXZlJztcbmltcG9ydCB7IERvbVNhbml0aXplciwgU2FmZUh0bWwgfSBmcm9tICdAYW5ndWxhci9wbGF0Zm9ybS1icm93c2VyJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlVGltZSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IFNrbHRuQ29uZmlnIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9za2x0bi1jb25maWcnO1xuaW1wb3J0IHsgU2tsdG5TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvc2tsdG4uc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3NrbHRuLXJvb3QnLFxuICB0ZW1wbGF0ZVVybDogJy4vc2tsdG4uY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9za2x0bi5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIFNrbHRuQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIEFmdGVyVmlld0luaXQge1xuXG4gIEBJbnB1dCgpIHJlY3RSYWRpdXM6IG51bWJlcjtcblxuICBASW5wdXQoKSBiZ0ZpbGw6IHN0cmluZztcblxuICBASW5wdXQoKSBmbGFyZUZpbGw6IHN0cmluZztcblxuICBASW5wdXQoKSBmbGFyZVdpZHRoOiBzdHJpbmc7XG5cbiAgQElucHV0KCkgZHVyYXRpb246IG51bWJlcjtcblxuICBASW5wdXQoKSBkZWxheTogbnVtYmVyO1xuXG4gIEBJbnB1dCgpIHRpbWluZzogc3RyaW5nO1xuXG4gIEBJbnB1dCgpIHNob3dTa2x0biA9IHRydWU7XG5cbiAgQENvbnRlbnRDaGlsZHJlbihTa2x0bkJvbmVEaXJlY3RpdmUpIGJvbmVzOiBRdWVyeUxpc3Q8U2tsdG5Cb25lRGlyZWN0aXZlPjtcblxuICB2aWV3Qm94OiBzdHJpbmc7XG5cbiAgc2hhcGVzOiBhbnlbXTtcblxuICBwYXJlbnRDbGllbnRSZWN0OiBhbnk7XG5cbiAgYW5pbWF0aW9uQ3NzOiBTYWZlSHRtbDtcblxuICBocmVmOiBzdHJpbmc7XG5cbiAgc3VmaXg6IHN0cmluZztcblxuICBncmFkaWVudElkOiBzdHJpbmc7XG5cbiAgbWFza0lkOiBzdHJpbmc7XG5cbiAgY2hlY2tIcmVmSW50ZXJ2YWxJRDogbnVtYmVyO1xuXG4gIHVwZFN0cmVhbSQgPSBuZXcgU3ViamVjdCgpO1xuXG4gIGRlZmF1bHRDb25maWc6IFNrbHRuQ29uZmlnID0ge1xuICAgIHJlY3RSYWRpdXM6IDQsXG4gICAgYmdGaWxsOiAnI2RkZCcsXG4gICAgZmxhcmVGaWxsOiAncmdiYSgyNTUsIDI1NSwgMjU1LCAwLjYpJyxcbiAgICBmbGFyZVdpZHRoOiAnMTUwcHgnLFxuICAgIGR1cmF0aW9uOiAxMjAwLFxuICAgIGRlbGF5OiAwLFxuICAgIHRpbWluZzogJ2Vhc2UtaW4tb3V0JyxcbiAgfTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHNrbHRuU2VydmljZTogU2tsdG5TZXJ2aWNlLFxuICAgIHByaXZhdGUgZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIHNhbml0aXplcjogRG9tU2FuaXRpemVyLFxuICAgIHByaXZhdGUgY2Q6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgem9uZTogTmdab25lLFxuICApIHtcbiAgICBjb25zdCBjb25mID0gdGhpcy5za2x0blNlcnZpY2UuY29uZmlnO1xuICAgIHRoaXMucmVjdFJhZGl1cyA9IGNvbmYucmVjdFJhZGl1cztcbiAgICB0aGlzLmJnRmlsbCA9IGNvbmYuYmdGaWxsO1xuICAgIHRoaXMuZmxhcmVGaWxsID0gY29uZi5mbGFyZUZpbGw7XG4gICAgdGhpcy5mbGFyZVdpZHRoID0gY29uZi5mbGFyZVdpZHRoO1xuICAgIHRoaXMuZHVyYXRpb24gPSBjb25mLmR1cmF0aW9uO1xuICAgIHRoaXMuZGVsYXkgPSBjb25mLmRlbGF5O1xuICAgIHRoaXMudGltaW5nID0gY29uZi50aW1pbmc7XG4gICAgdGhpcy5zdWZpeCA9IHRoaXMuZ2V0U3VmaXhXaXRoSUQoKTtcbiAgICB0aGlzLmdyYWRpZW50SWQgPSAnZ3JhZGllbnQtJyArIHRoaXMuc3VmaXg7XG4gICAgdGhpcy5tYXNrSWQgPSAnbWFzay0nICsgdGhpcy5zdWZpeDtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnLCBbJyRldmVudCddKVxuICBvblJlc2l6ZShldmVudDogRXZlbnQpIHtcbiAgICB0aGlzLnVwZFN0cmVhbSQubmV4dCgpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5hbmltYXRpb25Dc3MgPSB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0SHRtbChgXG4gICAgPHN0eWxlPlxuICAgIEBrZXlmcmFtZXMgZmxhcmVBbmltYXRpb24ge1xuICAgICAgICAwJSB7IHg6IGNhbGMoMCUgLSAke3RoaXMuZmxhcmVXaWR0aH0pOyB9XG4gICAgICAgIDEwMCUgeyB4OiAxMDAlOyB9XG4gICAgfVxuICAgIC5mbGFyZSB7XG4gICAgICBhbmltYXRpb24tbmFtZTogZmxhcmVBbmltYXRpb247XG4gICAgICBhbmltYXRpb24tZHVyYXRpb246ICR7dGhpcy5kdXJhdGlvbn1tcztcbiAgICAgIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246ICR7dGhpcy50aW1pbmd9O1xuICAgICAgYW5pbWF0aW9uLWl0ZXJhdGlvbi1jb3VudDogaW5maW5pdGU7XG4gICAgICBhbmltYXRpb24tZGVsYXk6ICR7dGhpcy5kZWxheX1tcztcbiAgICB9XG4gICAgPC9zdHlsZT5gKTtcblxuICAgIC8vIFVwZGF0ZVxuICAgIHRoaXMudXBkU3RyZWFtJC5waXBlKFxuICAgICAgZGVib3VuY2VUaW1lKDEwMCksXG4gICAgKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5jYWxjU2hhcGVzKCkpO1xuXG4gICAgLy8gVXBkYXRlIGhyZWYgKFNhZmFyaSBCdWcsIFNWRyBSZWYgUGF0aClcbiAgICB0aGlzLmhyZWYgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcblxuICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICB0aGlzLmNoZWNrSHJlZkludGVydmFsSUQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5ocmVmICE9PSB3aW5kb3cubG9jYXRpb24uaHJlZikge1xuICAgICAgICAgIHRoaXMuaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgICAgICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB9XG4gICAgICB9LCAxMDApO1xuICAgIH0pO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuY2FsY1NoYXBlcygpO1xuICAgIHRoaXMuY2QuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuY2hlY2tIcmVmSW50ZXJ2YWxJRCkge1xuICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5jaGVja0hyZWZJbnRlcnZhbElEKTtcbiAgICB9XG4gIH1cblxuICBnZXRTdWZpeFdpdGhJRCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgNCkgKyAnLXNrbHRuJztcbiAgfVxuXG4gIGNhbGNTaGFwZXMoKTogdm9pZCB7XG4gICAgLy8gUm9vdCBTVkcgRWxlbWVudFxuICAgIGNvbnN0IGVsID0gdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gICAgdGhpcy5wYXJlbnRDbGllbnRSZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdGhpcy52aWV3Qm94ID0gYDAgMCAke3RoaXMucGFyZW50Q2xpZW50UmVjdC53aWR0aH0gJHt0aGlzLnBhcmVudENsaWVudFJlY3QuaGVpZ2h0fWA7XG5cbiAgICAvLyBTVkcgU2hhcGVzXG4gICAgdGhpcy5zaGFwZXMgPSB0aGlzLmJvbmVzLnRvQXJyYXkoKS5tYXAoYm9uZSA9PiB7XG4gICAgICBjb25zdCBib25lRWwgPSBib25lLmVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgICAgIGNvbnN0IGNsaWVudFJlY3QgPSBib25lRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBjb25zdCByYWRpdXMgPSBib25lLnJlY3RSYWRpdXMgfHwgdGhpcy5yZWN0UmFkaXVzO1xuICAgICAgaWYgKGJvbmUudHlwZSA9PT0gJ2NpcmNsZScpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiAnY2lyY2xlJyxcbiAgICAgICAgICBjeDogY2xpZW50UmVjdC54IC0gdGhpcy5wYXJlbnRDbGllbnRSZWN0LnggKyBjbGllbnRSZWN0LndpZHRoIC8gMixcbiAgICAgICAgICBjeTogY2xpZW50UmVjdC55IC0gdGhpcy5wYXJlbnRDbGllbnRSZWN0LnkgKyBjbGllbnRSZWN0LmhlaWdodCAvIDIsXG4gICAgICAgICAgcng6IGNsaWVudFJlY3Qud2lkdGggLyAyLFxuICAgICAgICAgIHJ5OiBjbGllbnRSZWN0LmhlaWdodCAvIDIsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZiAoYm9uZS50eXBlID09PSAncGF0aCcpIHtcbiAgICAgICAgY29uc3QgeCA9IGNsaWVudFJlY3QueCAtIHRoaXMucGFyZW50Q2xpZW50UmVjdC54O1xuICAgICAgICBjb25zdCB5ID0gY2xpZW50UmVjdC55IC0gdGhpcy5wYXJlbnRDbGllbnRSZWN0Lnk7XG4gICAgICAgIGxldCB0cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7eH0sICR7eX0pYDtcbiAgICAgICAgaWYgKGJvbmUucGF0aFdpZHRoICYmIGJvbmUucGF0aEhlaWdodCkge1xuICAgICAgICAgIGNvbnN0IHhTY2FsZSA9IChjbGllbnRSZWN0LndpZHRoIC8gYm9uZS5wYXRoV2lkdGgpLnRvRml4ZWQoMik7XG4gICAgICAgICAgY29uc3QgeVNjYWxlID0gKGNsaWVudFJlY3QuaGVpZ2h0IC8gYm9uZS5wYXRoSGVpZ2h0KS50b0ZpeGVkKDIpO1xuICAgICAgICAgIHRyYW5zZm9ybSArPSBgIHNjYWxlKCR7eFNjYWxlfSwgJHt5U2NhbGV9KWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiAncGF0aCcsXG4gICAgICAgICAgd2lkdGg6IGNsaWVudFJlY3Qud2lkdGgsXG4gICAgICAgICAgaGVpZ2h0OiBjbGllbnRSZWN0LmhlaWdodCxcbiAgICAgICAgICB0cmFuc2Zvcm0sXG4gICAgICAgICAgdGVtcGxhdGU6IGJvbmUudGVtcGxhdGUsXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiAncmVjdCcsXG4gICAgICAgIHg6IGNsaWVudFJlY3QueCAtIHRoaXMucGFyZW50Q2xpZW50UmVjdC54LFxuICAgICAgICB5OiBjbGllbnRSZWN0LnkgLSB0aGlzLnBhcmVudENsaWVudFJlY3QueSxcbiAgICAgICAgd2lkdGg6IGNsaWVudFJlY3Qud2lkdGgsXG4gICAgICAgIGhlaWdodDogY2xpZW50UmVjdC5oZWlnaHQsXG4gICAgICAgIHJ4OiByYWRpdXMsXG4gICAgICAgIHJ5OiByYWRpdXMsXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbn1cbiJdfQ==